 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTrack Pro - Smart Attendance System</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --background-color: #f5f7fa;
            --text-color: #333;
            --card-bg: white;
            --border-color: #ddd;
            --sidebar-bg: white;
            --header-bg: #3498db;
            --footer-bg: #2c3e50;
            --input-bg: white;
            --table-header-bg: #f8f9fa;
            --table-row-hover: #f8f9fa;
        }

        .dark-mode {
            --background-color: #1a1a1a;
            --text-color: #f0f0f0;
            --card-bg: #2d2d2d;
            --border-color: #444;
            --sidebar-bg: #252525;
            --header-bg: #1a3e72;
            --footer-bg: #1a1a1a;
            --input-bg: #333;
            --table-header-bg: #333;
            --table-row-hover: #383838;
            --light-color: #444;
            --dark-color: #f0f0f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--header-bg);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: background-color 0.3s;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: white;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 20px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: var(--secondary-color);
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
            height: fit-content;
            transition: background-color 0.3s;
        }

        .sidebar-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-color);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: block;
            padding: 10px 15px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .content-area {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            transition: background-color 0.3s;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .content-title {
            font-size: 1.5rem;
            color: var(--text-color);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: var(--input-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--input-bg);
            color: var(--text-color);
            cursor: pointer;
        }

        .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .row {
            display: flex;
            gap: 20px;
        }

        .col {
            flex: 1;
        }

        .camera-container {
            width: 100%;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            background-color: var(--light-color);
            position: relative;
            aspect-ratio: 16/9;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #canvas {
            display: none;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
        }

        .camera-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .result-container {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--light-color);
            display: none;
        }

        .student-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .student-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .student-details {
            color: #666;
            margin-bottom: 15px;
        }

        .attendance-status {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
        }

        .present {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .absent {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--accent-color);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 30px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            color: var(--text-color);
        }

        .data-table tr:hover {
            background-color: var(--table-row-hover);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-primary {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary-color);
        }

        .badge-success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
        }

        .badge-warning {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .alert-danger {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--accent-color);
            border-left: 4px solid var(--accent-color);
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .stat-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.up {
            color: var(--success-color);
        }

        .stat-change.down {
            color: var(--accent-color);
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        footer {
            background-color: var(--footer-bg);
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 2px;
            background-color: var(--primary-color);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column ul li a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #bbb;
            font-size: 0.9rem;
        }

        /* Add Student Form Styles */
        #studentPhotoPreview {
            width: 150px;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px dashed var(--border-color);
            display: block;
            margin-bottom: 15px;
        }

        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .photo-upload-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 10px;
        }

        .photo-upload-label:hover {
            background-color: var(--secondary-color);
        }

        #studentPhoto {
            display: none;
        }

        /* Responsive Styles */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .row {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .camera-controls {
                flex-wrap: wrap;
            }

            .modal-content {
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .content-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .tabs {
                flex-direction: column;
                border-bottom: none;
            }

            .tab {
                border-bottom: none;
                border-left: 3px solid transparent;
            }

            .tab.active {
                border-bottom: none;
                border-left-color: var(--primary-color);
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="logo-text">
                    <h1>EduTrack Pro</h1>
                    <p>Smart Attendance System</p>
                </div>
            </div>
            <div>
                <nav>
                    <ul>
                        <li><a href="#" class="active"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#" id="studentsLink"><i class="fas fa-users"></i> Students</a></li>
                        <li><a href="#" id="attendanceLink"><i class="fas fa-calendar-check"></i> Attendance</a></li>
                        <li><a href="#" id="reportsLink"><i class="fas fa-chart-bar"></i> Reports</a></li>
                    </ul>
                </nav>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="sidebar">
                <h3 class="sidebar-title">Quick Menu</h3>
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" id="dashboardLink"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" id="addStudentLink"><i class="fas fa-user-plus"></i> Add Student</a></li>
                    <li><a href="#" id="takeAttendanceLink"><i class="fas fa-camera"></i> Take Attendance</a></li>
                    <li><a href="#" id="studentListLink"><i class="fas fa-list"></i> Student List</a></li>
                    <li><a href="#" id="attendanceHistoryLink"><i class="fas fa-history"></i> Attendance History</a></li>
                    <li><a href="#" id="coursesLink"><i class="fas fa-graduation-cap"></i> Courses</a></li>
                    <li><a href="#" id="departmentsLink"><i class="fas fa-building"></i> Departments</a></li>
                </ul>

                <h3 class="sidebar-title" style="margin-top: 30px;">Departments</h3>
                <ul class="sidebar-menu">
                    <li><a href="#" data-dept="computer"><i class="fas fa-laptop-code"></i> Computer Science</a></li>
                    <li><a href="#" data-dept="business"><i class="fas fa-briefcase"></i> Business Admin</a></li>
                    <li><a href="#" data-dept="science"><i class="fas fa-flask"></i> Science</a></li>
                    <li><a href="#" data-dept="arts"><i class="fas fa-book"></i> Arts</a></li>
                    <li><a href="#" data-dept="health"><i class="fas fa-heartbeat"></i> Health Science</a></li>
                </ul>
            </div>

            <div class="content-area" id="mainContent">
                <!-- Dashboard Content -->
                <div id="dashboardContent">
                    <div class="content-header">
                        <h2 class="content-title">Dashboard</h2>
                        <div>
                            <button class="btn btn-primary" id="importBtn">
                                <i class="fas fa-file-import"></i> Import Students
                            </button>
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-title">Total Students</div>
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-change up">
                                <i class="fas fa-arrow-up"></i> 12% from last month
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Today's Attendance</div>
                            <div class="stat-value" id="todayAttendance">0</div>
                            <div class="stat-change down">
                                <i class="fas fa-arrow-down"></i> 5% from yesterday
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Active Courses</div>
                            <div class="stat-value" id="activeCourses">0</div>
                            <div class="stat-change up">
                                <i class="fas fa-arrow-up"></i> 3 new this month
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Departments</div>
                            <div class="stat-value" id="totalDepartments">0</div>
                            <div class="stat-change">
                                <i class="fas fa-equals"></i> No change
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="attendanceChart"></canvas>
                    </div>

                    <div class="table-container">
                        <div class="content-header">
                            <h2 class="content-title">Recent Attendance</h2>
                            <div>
                                <button class="btn btn-primary" id="exportRecentBtn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Student</th>
                                    <th>Enrollment</th>
                                    <th>Course</th>
                                    <th>Status</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="recentAttendanceTable">
                                <!-- Recent attendance data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Student Content -->
                <div id="addStudentContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Add New Student</h2>
                        <div>
                            <button class="btn btn-danger" id="cancelAddStudent">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>

                    <form id="addStudentForm">
                        <div class="photo-upload">
                            <img id="studentPhotoPreview" src="https://via.placeholder.com/150" alt="Student Photo Preview">
                            <label for="studentPhoto" class="photo-upload-label">
                                <i class="fas fa-camera"></i> Upload Photo
                            </label>
                            <input type="file" id="studentPhoto" accept="image/*">
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Enrollment Number</label>
                                    <input type="text" class="form-control" id="enrollmentNumber" required>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" class="form-control" id="dob">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phone">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Course</label>
                                    <select class="form-select" id="course" required>
                                        <option value="">-- Select Course --</option>
                                        <option value="bca">BCA</option>
                                        <option value="btech">B.Tech</option>
                                        <option value="cse">CSE</option>
                                        <option value="bba">BBA</option>
                                        <option value="mba">MBA</option>
                                        <option value="bcom">B.Com</option>
                                        <option value="bpt">BPT</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Department</label>
                                    <select class="form-select" id="department" required>
                                        <option value="">-- Select Department --</option>
                                        <option value="computer">Computer Science</option>
                                        <option value="business">Business Administration</option>
                                        <option value="science">Science</option>
                                        <option value="arts">Arts</option>
                                        <option value="health">Health Science</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Batch Year</label>
                                    <input type="text" class="form-control" id="batch" placeholder="e.g. 2022-2025" required>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label class="form-label">Current Semester</label>
                                    <select class="form-select" id="semester">
                                        <option value="1">Semester 1</option>
                                        <option value="2">Semester 2</option>
                                        <option value="3">Semester 3</option>
                                        <option value="4">Semester 4</option>
                                        <option value="5">Semester 5</option>
                                        <option value="6">Semester 6</option>
                                        <option value="7">Semester 7</option>
                                        <option value="8">Semester 8</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Address</label>
                            <textarea class="form-control" id="address" rows="3"></textarea>
                        </div>

                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Save Student
                        </button>
                    </form>
                </div>

                <!-- Take Attendance Content -->
                <div id="takeAttendanceContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Take Attendance</h2>
                        <div>
                            <button class="btn btn-primary" id="manualEntryBtn">
                                <i class="fas fa-keyboard"></i> Manual Entry
                            </button>
                        </div>
                    </div>

                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="face-recognition">Face Recognition</div>
                            <div class="tab" data-tab="manual-entry">Manual Entry</div>
                        </div>
                        <div class="tab-content active" id="face-recognition">
                            <div class="form-group">
                                <label class="form-label">Select Course</label>
                                <select class="form-select" id="courseSelect">
                                    <option value="">-- Select Course --</option>
                                    <option value="bca">BCA</option>
                                    <option value="btech">B.Tech</option>
                                    <option value="cse">CSE</option>
                                    <option value="bba">BBA</option>
                                    <option value="mba">MBA</option>
                                    <option value="bcom">B.Com</option>
                                    <option value="bpt">BPT</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Select Department</label>
                                <select class="form-select" id="deptSelect">
                                    <option value="">-- Select Department --</option>
                                    <option value="computer">Computer Science</option>
                                    <option value="business">Business Administration</option>
                                    <option value="science">Science</option>
                                    <option value="arts">Arts</option>
                                    <option value="health">Health Science</option>
                                </select>
                            </div>

                            <div class="camera-container">
                                <video id="video" autoplay playsinline></video>
                                <canvas id="canvas"></canvas>
                                <div class="camera-overlay" id="cameraOverlay">
                                    <div>
                                        <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                        <p>Please allow camera access to continue</p>
                                        <button class="btn btn-primary" id="enableCameraBtn">Enable Camera</button>
                                    </div>
                                </div>
                            </div>

                            <div class="camera-controls">
                                <button class="btn btn-success" id="startAttendanceBtn" disabled>
                                    <i class="fas fa-play"></i> Start Attendance
                                </button>
                                <button class="btn btn-warning" id="captureBtn" disabled>
                                    <i class="fas fa-camera"></i> Capture
                                </button>
                                <button class="btn btn-danger" id="stopCameraBtn" disabled>
                                    <i class="fas fa-stop"></i> Stop Camera
                                </button>
                            </div>

                            <div class="result-container" id="resultContainer">
                                <img src="" alt="Student Photo" class="student-photo" id="resultPhoto">
                                <h3 class="student-name" id="resultName">John Doe</h3>
                                <div class="student-details">
                                    <span id="resultEnrollment">EN123456</span> | 
                                    <span id="resultCourse">BCA</span> | 
                                    <span id="resultBatch">2022-25</span>
                                </div>
                                <div class="attendance-status present" id="attendanceStatus">PRESENT</div>
                                <div class="attendance-time" id="attendanceTime" style="margin-top: 10px; color: #666;">
                                    Marked at: <span id="timeStamp">10:30 AM, 15 Jun 2023</span>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="manual-entry">
                            <form id="manualAttendanceForm">
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label class="form-label">Enrollment Number</label>
                                            <input type="text" class="form-control" id="manualEnrollmentNumber" placeholder="Enter enrollment number">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label class="form-label">Date</label>
                                            <input type="date" class="form-control" id="attendanceDate">
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select class="form-select" id="attendanceStatusManual">
                                        <option value="present">Present</option>
                                        <option value="absent">Absent</option>
                                        <option value="late">Late</option>
                                        <option value="halfday">Half Day</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Remarks (Optional)</label>
                                    <textarea class="form-control" id="attendanceRemarks" rows="3" placeholder="Enter any remarks"></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Attendance
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="content-header">
                            <h2 class="content-title">Today's Attendance</h2>
                            <div>
                                <button class="btn btn-primary" id="exportTodayBtn">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Student</th>
                                    <th>Enrollment</th>
                                    <th>Course</th>
                                    <th>Department</th>
                                    <th>Status</th>
                                    <th>Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <!-- Attendance data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Student List Content -->
                <div id="studentListContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Student List</h2>
                        <div>
                            <button class="btn btn-primary" id="addNewStudentBtn">
                                <i class="fas fa-user-plus"></i> Add Student
                            </button>
                            <button class="btn btn-success" id="exportStudentsBtn">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Search Students</label>
                                <input type="text" class="form-control" id="studentSearch" placeholder="Search by name, enrollment, etc.">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Filter by Course</label>
                                <select class="form-select" id="filterCourse">
                                    <option value="">All Courses</option>
                                    <option value="bca">BCA</option>
                                    <option value="btech">B.Tech</option>
                                    <option value="cse">CSE</option>
                                    <option value="bba">BBA</option>
                                    <option value="mba">MBA</option>
                                    <option value="bcom">B.Com</option>
                                    <option value="bpt">BPT</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Photo</th>
                                    <th>Name</th>
                                    <th>Enrollment</th>
                                    <th>Course</th>
                                    <th>Department</th>
                                    <th>Batch</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <!-- Student data will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination" style="margin-top: 20px; display: flex; justify-content: center;">
                        <button class="btn btn-primary" id="prevPageBtn" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span style="margin: 0 15px; line-height: 38px;" id="pageInfo">Page 1 of 1</span>
                        <button class="btn btn-primary" id="nextPageBtn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Attendance History Content -->
                <div id="attendanceHistoryContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Attendance History</h2>
                        <div>
                            <button class="btn btn-primary" id="exportHistoryBtn">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>

                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Search</label>
                                <input type="text" class="form-control" id="historySearch" placeholder="Search by name, enrollment, etc.">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="date" class="form-control" id="startDate">
                                    <input type="date" class="form-control" id="endDate">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" style="margin-bottom: 20px;">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Filter by Course</label>
                                <select class="form-select" id="historyFilterCourse">
                                    <option value="">All Courses</option>
                                    <option value="bca">BCA</option>
                                    <option value="btech">B.Tech</option>
                                    <option value="cse">CSE</option>
                                    <option value="bba">BBA</option>
                                    <option value="mba">MBA</option>
                                    <option value="bcom">B.Com</option>
                                    <option value="bpt">BPT</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Filter by Status</label>
                                <select class="form-select" id="historyFilterStatus">
                                    <option value="">All Statuses</option>
                                    <option value="present">Present</option>
                                    <option value="absent">Absent</option>
                                    <option value="late">Late</option>
                                    <option value="halfday">Half Day</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Date</th>
                                    <th>Student</th>
                                    <th>Enrollment</th>
                                    <th>Course</th>
                                    <th>Department</th>
                                    <th>Status</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceHistoryTable">
                                <!-- Attendance history data will be inserted here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination" style="margin-top: 20px; display: flex; justify-content: center;">
                        <button class="btn btn-primary" id="historyPrevPageBtn" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span style="margin: 0 15px; line-height: 38px;" id="historyPageInfo">Page 1 of 1</span>
                        <button class="btn btn-primary" id="historyNextPageBtn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Courses Content -->
                <div id="coursesContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Courses Management</h2>
                        <div>
                            <button class="btn btn-success" id="addCourseBtn">
                                <i class="fas fa-plus"></i> Add Course
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Course Code</th>
                                    <th>Course Name</th>
                                    <th>Department</th>
                                    <th>Duration</th>
                                    <th>Students</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coursesTableBody">
                                <!-- Courses data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Departments Content -->
                <div id="departmentsContent" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Departments Management</h2>
                        <div>
                            <button class="btn btn-success" id="addDepartmentBtn">
                                <i class="fas fa-plus"></i> Add Department
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Department Code</th>
                                    <th>Department Name</th>
                                    <th>Head</th>
                                    <th>Courses</th>
                                    <th>Students</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departmentsTableBody">
                                <!-- Departments data will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Students Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Import Students</h3>
                <button class="modal-close" id="closeImportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger" id="importError" style="display: none;"></div>
                <div class="form-group">
                    <label class="form-label">Select File (Excel/CSV)</label>
                    <input type="file" class="form-control" id="studentFile" accept=".xlsx,.xls,.csv">
                </div>
                <div class="form-group">
                    <label class="form-label">Course</label>
                    <select class="form-select" id="importCourse">
                        <option value="">-- Select Course --</option>
                        <option value="bca">BCA</option>
                        <option value="btech">B.Tech</option>
                        <option value="cse">CSE</option>
                        <option value="bba">BBA</option>
                        <option value="mba">MBA</option>
                        <option value="bcom">B.Com</option>
                        <option value="bpt">BPT</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Department</label>
                    <select class="form-select" id="importDept">
                        <option value="">-- Select Department --</option>
                        <option value="computer">Computer Science</option>
                        <option value="business">Business Administration</option>
                        <option value="science">Science</option>
                        <option value="arts">Arts</option>
                        <option value="health">Health Science</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Batch Year</label>
                    <input type="text" class="form-control" id="importBatch" placeholder="e.g. 2022-2025">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelImport">Cancel</button>
                <button class="btn btn-success" id="confirmImport">Import</button>
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div class="modal" id="addCourseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Course</h3>
                <button class="modal-close" id="closeCourseModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="courseForm">
                    <div class="form-group">
                        <label class="form-label">Course Code</label>
                        <input type="text" class="form-control" id="courseCode" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Course Name</label>
                        <input type="text" class="form-control" id="courseName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <select class="form-select" id="courseDepartment" required>
                            <option value="">-- Select Department --</option>
                            <option value="computer">Computer Science</option>
                            <option value="business">Business Administration</option>
                            <option value="science">Science</option>
                            <option value="arts">Arts</option>
                            <option value="health">Health Science</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Duration (Years)</label>
                                <input type="number" class="form-control" id="courseDuration" min="1" max="5" value="3" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Total Semesters</label>
                                <input type="number" class="form-control" id="courseSemesters" min="2" max="10" value="6" required>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="courseDescription" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelCourse">Cancel</button>
                <button class="btn btn-success" id="saveCourse">Save Course</button>
            </div>
        </div>
    </div>

    <!-- Add Department Modal -->
    <div class="modal" id="addDepartmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Department</h3>
                <button class="modal-close" id="closeDepartmentModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="departmentForm">
                    <div class="form-group">
                        <label class="form-label">Department Code</label>
                        <input type="text" class="form-control" id="departmentCode" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department Name</label>
                        <input type="text" class="form-control" id="departmentName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department Head</label>
                        <input type="text" class="form-control" id="departmentHead" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="departmentDescription" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelDepartment">Cancel</button>
                <button class="btn btn-success" id="saveDepartment">Save Department</button>
            </div>
        </div>
    </div>

    <!-- View Student Modal -->
    <div class="modal" id="viewStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Student Details</h3>
                <button class="modal-close" id="closeViewStudentModal">&times;</button>
            </div>
            <div class="modal-body" id="studentDetailsContent">
                <!-- Student details will be inserted here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeViewStudentBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal" id="editStudentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Student</h3>
                <button class="modal-close" id="closeEditStudentModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editStudentForm">
                    <input type="hidden" id="editStudentId">
                    <div class="photo-upload">
                        <img id="editStudentPhotoPreview" src="https://via.placeholder.com/150" alt="Student Photo Preview">
                        <label for="editStudentPhoto" class="photo-upload-label">
                            <i class="fas fa-camera"></i> Change Photo
                        </label>
                        <input type="file" id="editStudentPhoto" accept="image/*">
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" id="editFirstName" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="editLastName" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Enrollment Number</label>
                                <input type="text" class="form-control" id="editEnrollmentNumber" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" id="editDob">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="editEmail">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="editPhone">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Course</label>
                                <select class="form-select" id="editCourse" required>
                                    <option value="">-- Select Course --</option>
                                    <option value="bca">BCA</option>
                                    <option value="btech">B.Tech</option>
                                    <option value="cse">CSE</option>
                                    <option value="bba">BBA</option>
                                    <option value="mba">MBA</option>
                                    <option value="bcom">B.Com</option>
                                    <option value="bpt">BPT</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select class="form-select" id="editDepartment" required>
                                    <option value="">-- Select Department --</option>
                                    <option value="computer">Computer Science</option>
                                    <option value="business">Business Administration</option>
                                    <option value="science">Science</option>
                                    <option value="arts">Arts</option>
                                    <option value="health">Health Science</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Batch Year</label>
                                <input type="text" class="form-control" id="editBatch" placeholder="e.g. 2022-2025" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label class="form-label">Current Semester</label>
                                <select class="form-select" id="editSemester">
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="editAddress" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" id="cancelEditStudent">Cancel</button>
                <button class="btn btn-success" id="saveEditStudent">Save Changes</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer-content">
            <div class="footer-column">
                <h3>EduTrack Pro</h3>
                <p>Advanced Smart Attendance System for educational institutions to automate and streamline attendance tracking using facial recognition technology.</p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#" id="footerHomeLink">Home</a></li>
                    <li><a href="#" id="footerStudentsLink">Students</a></li>
                    <li><a href="#" id="footerAttendanceLink">Attendance</a></li>
                    <li><a href="#" id="footerReportsLink">Reports</a></li>
                    <li><a href="#" id="footerSettingsLink">Settings</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Support</h3>
                <ul>
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Documentation</a></li>
                    <li><a href="#">API Reference</a></li>
                    <li><a href="#">Community</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contact Us</h3>
                <ul>
                    <li><i class="fas fa-map-marker-alt"></i> 123 Edu Street, Learning City</li>
                    <li><i class="fas fa-phone"></i> +1 234 567 890</li>
                    <li><i class="fas fa-envelope"></i> support@edutrackpro.com</li>
                </ul>
            </div>
        </div>
        <div class="container copyright">
            <p>&copy; 2023 EduTrack Pro. All rights reserved.</p>
        </div>
    </footer>

    <!-- Chart.js for Dashboard Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // DOM Elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const cameraOverlay = document.getElementById('cameraOverlay');
        const enableCameraBtn = document.getElementById('enableCameraBtn');
        const startAttendanceBtn = document.getElementById('startAttendanceBtn');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const resultContainer = document.getElementById('resultContainer');
        const resultPhoto = document.getElementById('resultPhoto');
        const resultName = document.getElementById('resultName');
        const resultEnrollment = document.getElementById('resultEnrollment');
        const resultCourse = document.getElementById('resultCourse');
        const resultBatch = document.getElementById('resultBatch');
        const attendanceStatus = document.getElementById('attendanceStatus');
        const timeStamp = document.getElementById('timeStamp');
        const attendanceTableBody = document.getElementById('attendanceTableBody');
        const importBtn = document.getElementById('importBtn');
        const importModal = document.getElementById('importModal');
        const closeImportModal = document.getElementById('closeImportModal');
        const cancelImport = document.getElementById('cancelImport');
        const confirmImport = document.getElementById('confirmImport');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const themeToggle = document.getElementById('themeToggle');
        const manualEntryBtn = document.getElementById('manualEntryBtn');
        const addNewStudentBtn = document.getElementById('addNewStudentBtn');
        const cancelAddStudent = document.getElementById('cancelAddStudent');
        const addStudentForm = document.getElementById('addStudentForm');
        const studentPhoto = document.getElementById('studentPhoto');
        const studentPhotoPreview = document.getElementById('studentPhotoPreview');
        const addCourseBtn = document.getElementById('addCourseBtn');
        const addCourseModal = document.getElementById('addCourseModal');
        const closeCourseModal = document.getElementById('closeCourseModal');
        const cancelCourse = document.getElementById('cancelCourse');
        const saveCourse = document.getElementById('saveCourse');
        const addDepartmentBtn = document.getElementById('addDepartmentBtn');
        const addDepartmentModal = document.getElementById('addDepartmentModal');
        const closeDepartmentModal = document.getElementById('closeDepartmentModal');
        const cancelDepartment = document.getElementById('cancelDepartment');
        const saveDepartment = document.getElementById('saveDepartment');
        const viewStudentModal = document.getElementById('viewStudentModal');
        const closeViewStudentModal = document.getElementById('closeViewStudentModal');
        const closeViewStudentBtn = document.getElementById('closeViewStudentBtn');
        const editStudentModal = document.getElementById('editStudentModal');
        const closeEditStudentModal = document.getElementById('closeEditStudentModal');
        const cancelEditStudent = document.getElementById('cancelEditStudent');
        const saveEditStudent = document.getElementById('saveEditStudent');
        const editStudentForm = document.getElementById('editStudentForm');
        const editStudentPhoto = document.getElementById('editStudentPhoto');
        const editStudentPhotoPreview = document.getElementById('editStudentPhotoPreview');

        // Content Areas
        const dashboardContent = document.getElementById('dashboardContent');
        const addStudentContent = document.getElementById('addStudentContent');
        const takeAttendanceContent = document.getElementById('takeAttendanceContent');
        const studentListContent = document.getElementById('studentListContent');
        const attendanceHistoryContent = document.getElementById('attendanceHistoryContent');
        const coursesContent = document.getElementById('coursesContent');
        const departmentsContent = document.getElementById('departmentsContent');

        // Navigation Links
        const dashboardLink = document.getElementById('dashboardLink');
        const addStudentLink = document.getElementById('addStudentLink');
        const takeAttendanceLink = document.getElementById('takeAttendanceLink');
        const studentListLink = document.getElementById('studentListLink');
        const attendanceHistoryLink = document.getElementById('attendanceHistoryLink');
        const coursesLink = document.getElementById('coursesLink');
        const departmentsLink = document.getElementById('departmentsLink');
        const studentsLink = document.getElementById('studentsLink');
        const attendanceLink = document.getElementById('attendanceLink');
        const reportsLink = document.getElementById('reportsLink');
        const footerHomeLink = document.getElementById('footerHomeLink');
        const footerStudentsLink = document.getElementById('footerStudentsLink');
        const footerAttendanceLink = document.getElementById('footerAttendanceLink');
        const footerReportsLink = document.getElementById('footerReportsLink');
        const footerSettingsLink = document.getElementById('footerSettingsLink');

        // Sample student database (in a real app, this would be in localStorage)
        let studentDatabase = [];
        let attendanceRecords = [];
        let courses = [];
        let departments = [];
        let stream = null;
        let isCameraOn = false;
        let isAttendanceRunning = false;
        let currentPage = 1;
        const studentsPerPage = 10;
        let currentHistoryPage = 1;
        const historyPerPage = 10;
        let attendanceChart = null;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Display initial data
            displayDashboardStats();
            displayRecentAttendance();
            displayStudentList();
            displayAttendanceHistory();
            displayCourses();
            displayDepartments();
            
            // Set default date for attendance
            document.getElementById('attendanceDate').valueAsDate = new Date();
            
            // Initialize dashboard chart
            initAttendanceChart();
            
            // Check camera permission on page load if on attendance page
            if (window.location.hash === '#takeAttendance') {
                showTakeAttendance();
                checkCameraPermission();
            }
        });

        function loadData() {
            // Load students from localStorage
            const storedStudents = localStorage.getItem('studentDatabase');
            if (storedStudents) {
                studentDatabase = JSON.parse(storedStudents);
            } else {
                // Sample data if no data exists
                studentDatabase = [
                    {
                        id: 1,
                        firstName: 'John',
                        lastName: 'Doe',
                        enrollment: 'EN2023001',
                        phone: '9876543210',
                        email: 'john.doe@example.com',
                        course: 'BCA',
                        department: 'Computer Science',
                        batch: '2022-2025',
                        semester: '3',
                        photo: 'https://randomuser.me/api/portraits/men/1.jpg',
                        address: '123 College Street, Mumbai'
                    },
                    {
                        id: 2,
                        firstName: 'Jane',
                        lastName: 'Smith',
                        enrollment: 'EN2023002',
                        phone: '9876543211',
                        email: 'jane.smith@example.com',
                        course: 'B.Tech',
                        department: 'Computer Science',
                        batch: '2022-2026',
                        semester: '3',
                        photo: 'https://randomuser.me/api/portraits/women/1.jpg',
                        address: '456 University Road, Delhi'
                    },
                    {
                        id: 3,
                        firstName: 'Robert',
                        lastName: 'Johnson',
                        enrollment: 'EN2023003',
                        phone: '9876543212',
                        email: 'robert.j@example.com',
                        course: 'MBA',
                        department: 'Business Administration',
                        batch: '2022-2024',
                        semester: '2',
                        photo: 'https://randomuser.me/api/portraits/men/2.jpg',
                        address: '789 Campus Avenue, Bangalore'
                    }
                ];
                localStorage.setItem('studentDatabase', JSON.stringify(studentDatabase));
            }

            // Load attendance records from localStorage
            const storedAttendance = localStorage.getItem('attendanceRecords');
            if (storedAttendance) {
                attendanceRecords = JSON.parse(storedAttendance);
            } else {
                // Sample attendance records
                const now = new Date();
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                
                attendanceRecords = [
                    {
                        studentId: 1,
                        name: 'John Doe',
                        enrollment: 'EN2023001',
                        course: 'BCA',
                        department: 'Computer Science',
                        status: 'present',
                        timestamp: now.toISOString(),
                        date: now.toLocaleDateString(),
                        time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    },
                    {
                        studentId: 2,
                        name: 'Jane Smith',
                        enrollment: 'EN2023002',
                        course: 'B.Tech',
                        department: 'Computer Science',
                        status: 'present',
                        timestamp: now.toISOString(),
                        date: now.toLocaleDateString(),
                        time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    },
                    {
                        studentId: 1,
                        name: 'John Doe',
                        enrollment: 'EN2023001',
                        course: 'BCA',
                        department: 'Computer Science',
                        status: 'present',
                        timestamp: yesterday.toISOString(),
                        date: yesterday.toLocaleDateString(),
                        time: yesterday.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    }
                ];
                localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            }

            // Load courses from localStorage
            const storedCourses = localStorage.getItem('courses');
            if (storedCourses) {
                courses = JSON.parse(storedCourses);
            } else {
                // Sample courses
                courses = [
                    {
                        id: 1,
                        code: 'BCA',
                        name: 'Bachelor of Computer Applications',
                        department: 'Computer Science',
                        duration: 3,
                        semesters: 6,
                        description: 'Undergraduate degree in computer applications'
                    },
                    {
                        id: 2,
                        code: 'B.TECH',
                        name: 'Bachelor of Technology',
                        department: 'Computer Science',
                        duration: 4,
                        semesters: 8,
                        description: 'Undergraduate engineering degree'
                    },
                    {
                        id: 3,
                        code: 'MBA',
                        name: 'Master of Business Administration',
                        department: 'Business Administration',
                        duration: 2,
                        semesters: 4,
                        description: 'Postgraduate degree in business management'
                    }
                ];
                localStorage.setItem('courses', JSON.stringify(courses));
            }

            // Load departments from localStorage
            const storedDepartments = localStorage.getItem('departments');
            if (storedDepartments) {
                departments = JSON.parse(storedDepartments);
            } else {
                // Sample departments
                departments = [
                    {
                        id: 1,
                        code: 'CS',
                        name: 'Computer Science',
                        head: 'Dr. Sharma',
                        description: 'Department of Computer Science and Engineering'
                    },
                    {
                        id: 2,
                        code: 'BA',
                        name: 'Business Administration',
                        head: 'Dr. Gupta',
                        description: 'Department of Business Administration and Management'
                    },
                    {
                        id: 3,
                        code: 'HS',
                        name: 'Health Science',
                        head: 'Dr. Patel',
                        description: 'Department of Health and Medical Sciences'
                    }
                ];
                localStorage.setItem('departments', JSON.stringify(departments));
            }
        }

        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Camera controls
            enableCameraBtn.addEventListener('click', enableCamera);
            startAttendanceBtn.addEventListener('click', startAttendance);
            captureBtn.addEventListener('click', captureImage);
            stopCameraBtn.addEventListener('click', stopCamera);

            // Import modal
            importBtn.addEventListener('click', () => importModal.style.display = 'flex');
            closeImportModal.addEventListener('click', () => importModal.style.display = 'none');
            cancelImport.addEventListener('click', () => importModal.style.display = 'none');
            confirmImport.addEventListener('click', importStudents);

            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Manual attendance form
            document.getElementById('manualAttendanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                markManualAttendance();
            });

            // Manual entry button
            manualEntryBtn.addEventListener('click', () => switchTab('manual-entry'));

            // Student photo upload
            studentPhoto.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        studentPhotoPreview.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Edit student photo upload
            editStudentPhoto.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        editStudentPhotoPreview.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Add student form
            addStudentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                addNewStudent();
            });

            // Navigation links
            dashboardLink.addEventListener('click', showDashboard);
            addStudentLink.addEventListener('click', showAddStudent);
            takeAttendanceLink.addEventListener('click', showTakeAttendance);
            studentListLink.addEventListener('click', showStudentList);
            attendanceHistoryLink.addEventListener('click', showAttendanceHistory);
            coursesLink.addEventListener('click', showCourses);
            departmentsLink.addEventListener('click', showDepartments);
            studentsLink.addEventListener('click', showStudentList);
            attendanceLink.addEventListener('click', showTakeAttendance);
            reportsLink.addEventListener('click', showAttendanceHistory);
            footerHomeLink.addEventListener('click', showDashboard);
            footerStudentsLink.addEventListener('click', showStudentList);
            footerAttendanceLink.addEventListener('click', showTakeAttendance);
            footerReportsLink.addEventListener('click', showAttendanceHistory);
            footerSettingsLink.addEventListener('click', showCourses);

            // Add new student button
            addNewStudentBtn.addEventListener('click', showAddStudent);
            cancelAddStudent.addEventListener('click', showDashboard);

            // Course management
            addCourseBtn.addEventListener('click', () => addCourseModal.style.display = 'flex');
            closeCourseModal.addEventListener('click', () => addCourseModal.style.display = 'none');
            cancelCourse.addEventListener('click', () => addCourseModal.style.display = 'none');
            saveCourse.addEventListener('click', addNewCourse);

            // Department management
            addDepartmentBtn.addEventListener('click', () => addDepartmentModal.style.display = 'flex');
            closeDepartmentModal.addEventListener('click', () => addDepartmentModal.style.display = 'none');
            cancelDepartment.addEventListener('click', () => addDepartmentModal.style.display = 'none');
            saveDepartment.addEventListener('click', addNewDepartment);

            // View student modal
            closeViewStudentModal.addEventListener('click', () => viewStudentModal.style.display = 'none');
            closeViewStudentBtn.addEventListener('click', () => viewStudentModal.style.display = 'none');

            // Edit student modal
            closeEditStudentModal.addEventListener('click', () => editStudentModal.style.display = 'none');
            cancelEditStudent.addEventListener('click', () => editStudentModal.style.display = 'none');
            saveEditStudent.addEventListener('click', saveEditedStudent);

            // Pagination
            document.getElementById('prevPageBtn').addEventListener('click', prevStudentPage);
            document.getElementById('nextPageBtn').addEventListener('click', nextStudentPage);
            document.getElementById('historyPrevPageBtn').addEventListener('click', prevHistoryPage);
            document.getElementById('historyNextPageBtn').addEventListener('click', nextHistoryPage);

            // Search and filters
            document.getElementById('studentSearch').addEventListener('input', filterStudents);
            document.getElementById('filterCourse').addEventListener('change', filterStudents);
            document.getElementById('historySearch').addEventListener('input', filterAttendanceHistory);
            document.getElementById('startDate').addEventListener('change', filterAttendanceHistory);
            document.getElementById('endDate').addEventListener('change', filterAttendanceHistory);
            document.getElementById('historyFilterCourse').addEventListener('change', filterAttendanceHistory);
            document.getElementById('historyFilterStatus').addEventListener('change', filterAttendanceHistory);

            // Department sidebar links
            document.querySelectorAll('[data-dept]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const dept = this.getAttribute('data-dept');
                    filterStudentsByDepartment(dept);
                });
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            
            // Reinitialize chart with new theme colors
            initAttendanceChart();
        }

        function showDashboard() {
            hideAllContent();
            dashboardContent.style.display = 'block';
            setActiveNavLink('dashboardLink');
            updateDashboard();
        }

        function showAddStudent() {
            hideAllContent();
            addStudentContent.style.display = 'block';
            setActiveNavLink('addStudentLink');
        }

        function showTakeAttendance() {
            hideAllContent();
            takeAttendanceContent.style.display = 'block';
            setActiveNavLink('takeAttendanceLink');
            switchTab('face-recognition');
            checkCameraPermission();
        }

        function showStudentList() {
            hideAllContent();
            studentListContent.style.display = 'block';
            setActiveNavLink('studentListLink');
            currentPage = 1;
            displayStudentList();
        }

        function showAttendanceHistory() {
            hideAllContent();
            attendanceHistoryContent.style.display = 'block';
            setActiveNavLink('attendanceHistoryLink');
            currentHistoryPage = 1;
            displayAttendanceHistory();
        }

        function showCourses() {
            hideAllContent();
            coursesContent.style.display = 'block';
            setActiveNavLink('coursesLink');
        }

        function showDepartments() {
            hideAllContent();
            departmentsContent.style.display = 'block';
            setActiveNavLink('departmentsLink');
        }

        function hideAllContent() {
            dashboardContent.style.display = 'none';
            addStudentContent.style.display = 'none';
            takeAttendanceContent.style.display = 'none';
            studentListContent.style.display = 'none';
            attendanceHistoryContent.style.display = 'none';
            coursesContent.style.display = 'none';
            departmentsContent.style.display = 'none';
        }

        function setActiveNavLink(linkId) {
            const navLinks = [
                'dashboardLink', 'addStudentLink', 'takeAttendanceLink', 
                'studentListLink', 'attendanceHistoryLink', 'coursesLink', 
                'departmentsLink', 'studentsLink', 'attendanceLink', 'reportsLink'
            ];
            
            navLinks.forEach(id => {
                const link = document.getElementById(id);
                if (id === linkId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        function switchTab(tabId) {
            // Update active tab
            tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            // Update active tab content
            tabContents.forEach(content => {
                if (content.id === tabId) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });

            // If switching to face recognition tab and camera was on, restart it
            if (tabId === 'face-recognition' && isCameraOn) {
                enableCamera();
            }
        }

        function checkCameraPermission() {
            // Check if the browser supports mediaDevices API
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                cameraOverlay.style.display = 'flex';
                cameraOverlay.innerHTML = `
                    <div>
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Your browser doesn't support camera access or this feature is not available.</p>
                    </div>
                `;
                return;
            }

            // Check if we already have permission
            navigator.permissions && navigator.permissions.query({ name: 'camera' }).then(permissionStatus => {
                if (permissionStatus.state === 'granted') {
                    enableCamera();
                } else {
                    cameraOverlay.style.display = 'flex';
                    cameraOverlay.innerHTML = `
                        <div>
                            <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Please allow camera access to continue</p>
                            <button class="btn btn-primary" id="enableCameraBtn">Enable Camera</button>
                        </div>
                    `;
                    document.getElementById('enableCameraBtn').addEventListener('click', enableCamera);
                }
            }).catch(() => {
                // If permissions API is not supported, just show the enable button
                cameraOverlay.style.display = 'flex';
                cameraOverlay.innerHTML = `
                    <div>
                        <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Please allow camera access to continue</p>
                        <button class="btn btn-primary" id="enableCameraBtn">Enable Camera</button>
                    </div>
                `;
                document.getElementById('enableCameraBtn').addEventListener('click', enableCamera);
            });
        }

        async function enableCamera() {
            try {
                cameraOverlay.style.display = 'none';
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: false
                });
                video.srcObject = stream;
                isCameraOn = true;
                startAttendanceBtn.disabled = false;
                stopCameraBtn.disabled = false;
                
                // Listen for when the camera is stopped (e.g., by the browser or OS)
                stream.getVideoTracks()[0].addEventListener('ended', () => {
                    stopCamera();
                    cameraOverlay.style.display = 'flex';
                    cameraOverlay.innerHTML = `
                        <div>
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Camera access was revoked. Please enable it again.</p>
                            <button class="btn btn-primary" id="enableCameraBtn">Enable Camera</button>
                        </div>
                    `;
                    document.getElementById('enableCameraBtn').addEventListener('click', enableCamera);
                });
            } catch (err) {
                console.error('Error accessing camera:', err);
                cameraOverlay.style.display = 'flex';
                
                let errorMessage = 'Could not access camera. Please check permissions.';
                if (err.name === 'NotAllowedError') {
                    errorMessage = 'Camera access was denied. Please allow camera permissions in your browser settings.';
                } else if (err.name === 'NotFoundError') {
                    errorMessage = 'No camera device found. Please connect a camera and try again.';
                } else if (err.name === 'NotReadableError') {
                    errorMessage = 'Camera is already in use by another application.';
                }
                
                cameraOverlay.innerHTML = `
                    <div>
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>${errorMessage}</p>
                        <button class="btn btn-primary" id="retryCameraBtn">Retry</button>
                    </div>
                `;
                document.getElementById('retryCameraBtn').addEventListener('click', enableCamera);
            }
        }

        function startAttendance() {
            if (!isCameraOn) return;

            isAttendanceRunning = true;
            startAttendanceBtn.disabled = true;
            captureBtn.disabled = false;
            startAttendanceBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Attendance Running...';
            
            // In a real app, you would start face recognition here
            console.log('Attendance process started');
        }

        function captureImage() {
            if (!isCameraOn || !isAttendanceRunning) return;

            // Set canvas dimensions to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // In a real app, you would process the image for face recognition here
            // For demo purposes, we'll simulate a match with a random student
            simulateFaceRecognition();
        }

        function simulateFaceRecognition() {
            // Get selected course and department
            const course = document.getElementById('courseSelect').value;
            const dept = document.getElementById('deptSelect').value;
            
            // Filter students by course and department if selected
            let eligibleStudents = studentDatabase;
            if (course) {
                eligibleStudents = eligibleStudents.filter(student => student.course.toLowerCase() === course);
            }
            if (dept) {
                eligibleStudents = eligibleStudents.filter(student => student.department.toLowerCase() === dept);
            }
            
            if (eligibleStudents.length === 0) {
                alert('No students found matching the selected criteria');
                return;
            }
            
            // Pick a random student from eligible students
            const randomIndex = Math.floor(Math.random() * eligibleStudents.length);
            const randomStudent = eligibleStudents[randomIndex];
            
            // Display the result
            resultPhoto.src = randomStudent.photo;
            resultName.textContent = `${randomStudent.firstName} ${randomStudent.lastName}`;
            resultEnrollment.textContent = randomStudent.enrollment;
            resultCourse.textContent = randomStudent.course;
            resultBatch.textContent = randomStudent.batch;
            
            // Mark attendance
            const now = new Date();
            const attendanceRecord = {
                studentId: randomStudent.id,
                name: `${randomStudent.firstName} ${randomStudent.lastName}`,
                enrollment: randomStudent.enrollment,
                course: randomStudent.course,
                department: randomStudent.department,
                status: 'present',
                timestamp: now.toISOString(),
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            attendanceRecords.push(attendanceRecord);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            // Update UI
            attendanceStatus.textContent = 'PRESENT';
            attendanceStatus.className = 'attendance-status present';
            timeStamp.textContent = `${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}, ${now.toLocaleDateString()}`;
            resultContainer.style.display = 'block';
            
            // Update attendance table
            displayAttendanceData();
            displayRecentAttendance();
            updateDashboard();
            
            // Scroll to result
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                isCameraOn = false;
                isAttendanceRunning = false;
                video.srcObject = null;
                cameraOverlay.style.display = 'flex';
                cameraOverlay.innerHTML = `
                    <div>
                        <i class="fas fa-camera" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Camera is turned off</p>
                        <button class="btn btn-primary" id="enableCameraBtn">Enable Camera</button>
                    </div>
                `;
                document.getElementById('enableCameraBtn').addEventListener('click', enableCamera);
                
                // Reset buttons
                startAttendanceBtn.disabled = true;
                captureBtn.disabled = true;
                stopCameraBtn.disabled = true;
                startAttendanceBtn.innerHTML = '<i class="fas fa-play"></i> Start Attendance';
                
                // Hide result
                resultContainer.style.display = 'none';
            }
        }

        function markManualAttendance() {
            const enrollment = document.getElementById('manualEnrollmentNumber').value;
            const date = document.getElementById('attendanceDate').value;
            const status = document.getElementById('attendanceStatusManual').value;
            const remarks = document.getElementById('attendanceRemarks').value;
            
            if (!enrollment) {
                alert('Please enter enrollment number');
                return;
            }
            
            // Find student
            const student = studentDatabase.find(s => s.enrollment === enrollment);
            if (!student) {
                alert('Student not found with this enrollment number');
                return;
            }
            
            // Create attendance record
            const now = new Date();
            const attendanceDate = date ? new Date(date) : now;
            
            const attendanceRecord = {
                studentId: student.id,
                name: `${student.firstName} ${student.lastName}`,
                enrollment: student.enrollment,
                course: student.course,
                department: student.department,
                status: status,
                remarks: remarks,
                timestamp: attendanceDate.toISOString(),
                date: attendanceDate.toLocaleDateString(),
                time: now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            attendanceRecords.push(attendanceRecord);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            // Update attendance table
            displayAttendanceData();
            displayRecentAttendance();
            updateDashboard();
            
            // Show success message
            alert('Attendance marked successfully!');
            
            // Reset form
            document.getElementById('manualAttendanceForm').reset();
        }

        function addNewStudent() {
            // Get form values
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const enrollment = document.getElementById('enrollmentNumber').value;
            const dob = document.getElementById('dob').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const course = document.getElementById('course').value;
            const department = document.getElementById('department').value;
            const batch = document.getElementById('batch').value;
            const semester = document.getElementById('semester').value;
            const address = document.getElementById('address').value;
            const photo = studentPhotoPreview.src;
            
            // Validate required fields
            if (!firstName || !lastName || !enrollment || !course || !department || !batch) {
                alert('Please fill all required fields');
                return;
            }
            
            // Check if enrollment already exists
            if (studentDatabase.some(student => student.enrollment === enrollment)) {
                alert('A student with this enrollment number already exists');
                return;
            }
            
            // Create new student
            const newStudent = {
                id: studentDatabase.length > 0 ? Math.max(...studentDatabase.map(s => s.id)) + 1 : 1,
                firstName,
                lastName,
                enrollment,
                dob,
                email,
                phone,
                course,
                department,
                batch,
                semester,
                address,
                photo
            };
            
            // Add to database
            studentDatabase.push(newStudent);
            localStorage.setItem('studentDatabase', JSON.stringify(studentDatabase));
            
            // Show success message
            alert('Student added successfully!');
            
            // Reset form
            addStudentForm.reset();
            studentPhotoPreview.src = 'https://via.placeholder.com/150';
            
            // Update student list and dashboard
            displayStudentList();
            updateDashboard();
            
            // Return to dashboard
            showDashboard();
        }

        function displayDashboardStats() {
            document.getElementById('totalStudents').textContent = studentDatabase.length;
            
            // Count today's attendance
            const today = new Date().toLocaleDateString();
            const todayCount = attendanceRecords.filter(record => record.date === today).length;
            document.getElementById('todayAttendance').textContent = todayCount;
            
            // Count unique courses
            const uniqueCourses = [...new Set(studentDatabase.map(student => student.course))];
            document.getElementById('activeCourses').textContent = uniqueCourses.length;
            
            // Count unique departments
            const uniqueDepts = [...new Set(studentDatabase.map(student => student.department))];
            document.getElementById('totalDepartments').textContent = uniqueDepts.length;
        }

        function displayRecentAttendance() {
            const recentAttendanceTable = document.getElementById('recentAttendanceTable');
            recentAttendanceTable.innerHTML = '';
            
            // Get today's attendance records
            const today = new Date().toLocaleDateString();
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            if (todayRecords.length === 0) {
                recentAttendanceTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">No attendance records for today</td>
                    </tr>
                `;
                return;
            }
            
            // Display up to 5 most recent records
            const recentRecords = todayRecords.slice(-5).reverse();
            
            recentRecords.forEach((record, index) => {
                const student = studentDatabase.find(s => s.id === record.studentId);
                const photoUrl = student ? student.photo : 'https://via.placeholder.com/40';
                
                let statusBadge;
                if (record.status === 'present') {
                    statusBadge = '<span class="badge badge-success">Present</span>';
                } else if (record.status === 'absent') {
                    statusBadge = '<span class="badge badge-danger">Absent</span>';
                } else if (record.status === 'late') {
                    statusBadge = '<span class="badge badge-warning">Late</span>';
                } else {
                    statusBadge = `<span class="badge badge-primary">${record.status}</span>`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${photoUrl}" alt="${record.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            ${record.name}
                        </div>
                    </td>
                    <td>${record.enrollment}</td>
                    <td>${record.course}</td>
                    <td>${statusBadge}</td>
                    <td>${record.time}</td>
                `;
                recentAttendanceTable.appendChild(row);
            });
        }

        function displayAttendanceData() {
            attendanceTableBody.innerHTML = '';
            
            // Get today's date for filtering
            const today = new Date().toLocaleDateString();
            
            // Filter today's attendance
            const todayRecords = attendanceRecords.filter(record => record.date === today);
            
            if (todayRecords.length === 0) {
                attendanceTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No attendance records for today</td>
                    </tr>
                `;
                return;
            }
            
            // Add rows for each attendance record
            todayRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                
                // Find student for photo
                const student = studentDatabase.find(s => s.id === record.studentId);
                const photoUrl = student ? student.photo : 'https://via.placeholder.com/40';
                
                // Status badge
                let statusBadge;
                if (record.status === 'present') {
                    statusBadge = '<span class="badge badge-success">Present</span>';
                } else if (record.status === 'absent') {
                    statusBadge = '<span class="badge badge-danger">Absent</span>';
                } else if (record.status === 'late') {
                    statusBadge = '<span class="badge badge-warning">Late</span>';
                } else {
                    statusBadge = `<span class="badge badge-primary">${record.status}</span>`;
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${photoUrl}" alt="${record.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            ${record.name}
                        </div>
                    </td>
                    <td>${record.enrollment}</td>
                    <td>${record.course}</td>
                    <td>${record.department}</td>
                    <td>${statusBadge}</td>
                    <td>${record.time}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn btn-danger" title="Delete" data-id="${record.timestamp}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                attendanceTableBody.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.action-btn.btn-danger').addEventListener('click', function() {
                    const timestamp = this.getAttribute('data-id');
                    deleteAttendanceRecord(timestamp);
                });
            });
        }

        function displayStudentList() {
            const studentTableBody = document.getElementById('studentTableBody');
            studentTableBody.innerHTML = '';
            
            if (studentDatabase.length === 0) {
                studentTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No students found</td>
                    </tr>
                `;
                return;
            }
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = Math.min(startIndex + studentsPerPage, studentDatabase.length);
            const paginatedStudents = studentDatabase.slice(startIndex, endIndex);
            
            // Add rows for each student
            paginatedStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                const fullName = `${student.firstName} ${student.lastName}`;
                
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>
                        <img src="${student.photo}" alt="${fullName}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                    </td>
                    <td>${fullName}</td>
                    <td>${student.enrollment}</td>
                    <td>${student.course}</td>
                    <td>${student.department}</td>
                    <td>${student.batch}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn btn-primary" title="View" data-id="${student.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-warning" title="Edit" data-id="${student.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" title="Delete" data-id="${student.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                studentTableBody.appendChild(row);
                
                // Add event listeners to action buttons
                row.querySelector('.action-btn.btn-primary').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    viewStudentDetails(studentId);
                });
                
                row.querySelector('.action-btn.btn-warning').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    editStudent(studentId);
                });
                
                row.querySelector('.action-btn.btn-danger').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    deleteStudent(studentId);
                });
            });
            
            // Update pagination controls
            updatePaginationControls();
        }

        function editStudent(studentId) {
            const student = studentDatabase.find(s => s.id === studentId);
            if (!student) {
                alert('Student not found');
                return;
            }
            
            // Populate the edit form
            document.getElementById('editStudentId').value = student.id;
            document.getElementById('editFirstName').value = student.firstName;
            document.getElementById('editLastName').value = student.lastName;
            document.getElementById('editEnrollmentNumber').value = student.enrollment;
            document.getElementById('editDob').value = student.dob || '';
            document.getElementById('editEmail').value = student.email || '';
            document.getElementById('editPhone').value = student.phone || '';
            document.getElementById('editCourse').value = student.course.toLowerCase();
            document.getElementById('editDepartment').value = student.department.toLowerCase();
            document.getElementById('editBatch').value = student.batch;
            document.getElementById('editSemester').value = student.semester || '1';
            document.getElementById('editAddress').value = student.address || '';
            editStudentPhotoPreview.src = student.photo;
            
            // Show the modal
            editStudentModal.style.display = 'flex';
        }

        function saveEditedStudent() {
            const studentId = parseInt(document.getElementById('editStudentId').value);
            const studentIndex = studentDatabase.findIndex(s => s.id === studentId);
            
            if (studentIndex === -1) {
                alert('Student not found');
                return;
            }
            
            // Get form values
            const firstName = document.getElementById('editFirstName').value;
            const lastName = document.getElementById('editLastName').value;
            const enrollment = document.getElementById('editEnrollmentNumber').value;
            const dob = document.getElementById('editDob').value;
            const email = document.getElementById('editEmail').value;
            const phone = document.getElementById('editPhone').value;
            const course = document.getElementById('editCourse').value;
            const department = document.getElementById('editDepartment').value;
            const batch = document.getElementById('editBatch').value;
            const semester = document.getElementById('editSemester').value;
            const address = document.getElementById('editAddress').value;
            const photo = editStudentPhotoPreview.src;
            
            // Validate required fields
            if (!firstName || !lastName || !enrollment || !course || !department || !batch) {
                alert('Please fill all required fields');
                return;
            }
            
            // Check if enrollment already exists for another student
            if (studentDatabase.some(student => student.enrollment === enrollment && student.id !== studentId)) {
                alert('A student with this enrollment number already exists');
                return;
            }
            
            // Update student
            studentDatabase[studentIndex] = {
                ...studentDatabase[studentIndex],
                firstName,
                lastName,
                enrollment,
                dob,
                email,
                phone,
                course,
                department,
                batch,
                semester,
                address,
                photo
            };
            
            // Save to database
            localStorage.setItem('studentDatabase', JSON.stringify(studentDatabase));
            
            // Close modal
            editStudentModal.style.display = 'none';
            
            // Show success message
            alert('Student updated successfully!');
            
            // Update displays
            displayStudentList();
            displayAttendanceData();
            updateDashboard();
        }

        function displayAttendanceHistory() {
            const attendanceHistoryTable = document.getElementById('attendanceHistoryTable');
            attendanceHistoryTable.innerHTML = '';
            
            if (attendanceRecords.length === 0) {
                attendanceHistoryTable.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No attendance records found</td>
                    </tr>
                `;
                return;
            }
            
            // Calculate pagination
            const startIndex = (currentHistoryPage - 1) * historyPerPage;
            const endIndex = Math.min(startIndex + historyPerPage, attendanceRecords.length);
            const paginatedRecords = attendanceRecords.slice(startIndex, endIndex).reverse();
            
            // Add rows for each attendance record
            paginatedRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                
                // Find student for photo
                const student = studentDatabase.find(s => s.id === record.studentId);
                const photoUrl = student ? student.photo : 'https://via.placeholder.com/40';
                
                // Status badge
                let statusBadge;
                if (record.status === 'present') {
                    statusBadge = '<span class="badge badge-success">Present</span>';
                } else if (record.status === 'absent') {
                    statusBadge = '<span class="badge badge-danger">Absent</span>';
                } else if (record.status === 'late') {
                    statusBadge = '<span class="badge badge-warning">Late</span>';
                } else {
                    statusBadge = `<span class="badge badge-primary">${record.status}</span>`;
                }
                
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${record.date}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${photoUrl}" alt="${record.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            ${record.name}
                        </div>
                    </td>
                    <td>${record.enrollment}</td>
                    <td>${record.course}</td>
                    <td>${record.department}</td>
                    <td>${statusBadge}</td>
                    <td>${record.time}</td>
                `;
                
                attendanceHistoryTable.appendChild(row);
            });
            
            // Update history pagination controls
            updateHistoryPaginationControls();
        }

        function displayCourses() {
            const coursesTableBody = document.getElementById('coursesTableBody');
            coursesTableBody.innerHTML = '';
            
            if (courses.length === 0) {
                coursesTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">No courses found</td>
                    </tr>
                `;
                return;
            }
            
            // Add rows for each course
            courses.forEach((course, index) => {
                const row = document.createElement('tr');
                
                // Count students in this course
                const studentCount = studentDatabase.filter(student => student.course === course.name).length;
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${course.code}</td>
                    <td>${course.name}</td>
                    <td>${course.department}</td>
                    <td>${course.duration} Years</td>
                    <td>${studentCount}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn btn-danger" title="Delete" data-id="${course.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                coursesTableBody.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.action-btn.btn-danger').addEventListener('click', function() {
                    const courseId = parseInt(this.getAttribute('data-id'));
                    deleteCourse(courseId);
                });
            });
        }

        function displayDepartments() {
            const departmentsTableBody = document.getElementById('departmentsTableBody');
            departmentsTableBody.innerHTML = '';
            
            if (departments.length === 0) {
                departmentsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">No departments found</td>
                    </tr>
                `;
                return;
            }
            
            // Add rows for each department
            departments.forEach((dept, index) => {
                const row = document.createElement('tr');
                
                // Count courses and students in this department
                const courseCount = courses.filter(course => course.department === dept.name).length;
                const studentCount = studentDatabase.filter(student => student.department === dept.name).length;
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${dept.code}</td>
                    <td>${dept.name}</td>
                    <td>${dept.head}</td>
                    <td>${courseCount}</td>
                    <td>${studentCount}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn btn-danger" title="Delete" data-id="${dept.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                departmentsTableBody.appendChild(row);
                
                // Add event listener to delete button
                row.querySelector('.action-btn.btn-danger').addEventListener('click', function() {
                    const deptId = parseInt(this.getAttribute('data-id'));
                    deleteDepartment(deptId);
                });
            });
        }

        function viewStudentDetails(studentId) {
            const student = studentDatabase.find(s => s.id === studentId);
            if (!student) {
                alert('Student not found');
                return;
            }
            
            const studentDetailsContent = document.getElementById('studentDetailsContent');
            studentDetailsContent.innerHTML = `
                <div style="display: flex; gap: 30px; margin-bottom: 20px;">
                    <div>
                        <img src="${student.photo}" alt="${student.firstName} ${student.lastName}" 
                             style="width: 150px; height: 150px; border-radius: 8px; object-fit: cover;">
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px;">${student.firstName} ${student.lastName}</h3>
                        <p><strong>Enrollment:</strong> ${student.enrollment}</p>
                        <p><strong>Course:</strong> ${student.course}</p>
                        <p><strong>Department:</strong> ${student.department}</p>
                        <p><strong>Batch:</strong> ${student.batch}</p>
                        <p><strong>Semester:</strong> ${student.semester}</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px;">Contact Information</h4>
                    <p><strong>Email:</strong> ${student.email || 'N/A'}</p>
                    <p><strong>Phone:</strong> ${student.phone || 'N/A'}</p>
                    <p><strong>Address:</strong> ${student.address || 'N/A'}</p>
                    <p><strong>Date of Birth:</strong> ${student.dob || 'N/A'}</p>
                </div>
                
                <div>
                    <h4 style="margin-bottom: 10px;">Attendance Summary</h4>
                    <p>Total Attendance Records: ${attendanceRecords.filter(r => r.studentId === studentId).length}</p>
                </div>
            `;
            
            viewStudentModal.style.display = 'flex';
        }

        function deleteStudent(studentId) {
            if (!confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                return;
            }
            
            // Remove student from database
            studentDatabase = studentDatabase.filter(student => student.id !== studentId);
            localStorage.setItem('studentDatabase', JSON.stringify(studentDatabase));
            
            // Remove student's attendance records
            attendanceRecords = attendanceRecords.filter(record => record.studentId !== studentId);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            // Update displays
            displayStudentList();
            displayAttendanceData();
            displayRecentAttendance();
            updateDashboard();
            
            alert('Student deleted successfully');
        }

        function deleteAttendanceRecord(timestamp) {
            if (!confirm('Are you sure you want to delete this attendance record?')) {
                return;
            }
            
            attendanceRecords = attendanceRecords.filter(record => record.timestamp !== timestamp);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            displayAttendanceData();
            displayRecentAttendance();
            updateDashboard();
            
            alert('Attendance record deleted successfully');
        }

        function deleteCourse(courseId) {
            if (!confirm('Are you sure you want to delete this course? Students associated with this course will not be deleted.')) {
                return;
            }
            
            courses = courses.filter(course => course.id !== courseId);
            localStorage.setItem('courses', JSON.stringify(courses));
            
            displayCourses();
            updateDashboard();
            
            alert('Course deleted successfully');
        }

        function deleteDepartment(deptId) {
            if (!confirm('Are you sure you want to delete this department? Courses and students associated with this department will not be deleted.')) {
                return;
            }
            
            departments = departments.filter(dept => dept.id !== deptId);
            localStorage.setItem('departments', JSON.stringify(departments));
            
            displayDepartments();
            updateDashboard();
            
            alert('Department deleted successfully');
        }

        function importStudents() {
            const fileInput = document.getElementById('studentFile');
            const course = document.getElementById('importCourse').value;
            const dept = document.getElementById('importDept').value;
            const batch = document.getElementById('importBatch').value;
            
            // Validate inputs
            if (!fileInput.files.length) {
                showImportError('Please select a file to import');
                return;
            }
            
            if (!course || !dept || !batch) {
                showImportError('Please fill all required fields');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    // In a real app, you would parse the Excel/CSV file here
                    // For demo, we'll just add some sample students
                    
                    // Generate some sample students
                    const newStudents = [
                        {
                            id: studentDatabase.length > 0 ? Math.max(...studentDatabase.map(s => s.id)) + 1 : 1,
                            firstName: 'Imported',
                            lastName: 'Student 1',
                            enrollment: `EN${new Date().getFullYear()}${studentDatabase.length + 1001}`,
                            phone: '987654321' + (studentDatabase.length + 1),
                            email: `student${studentDatabase.length + 1}@example.com`,
                            course: document.querySelector(`#importCourse option[value="${course}"]`).textContent,
                            department: document.querySelector(`#importDept option[value="${dept}"]`).textContent,
                            batch: batch,
                            semester: '1',
                            photo: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${studentDatabase.length + 1}.jpg`,
                            address: 'Imported student address'
                        },
                        {
                            id: studentDatabase.length > 0 ? Math.max(...studentDatabase.map(s => s.id)) + 2 : 2,
                            firstName: 'Imported',
                            lastName: 'Student 2',
                            enrollment: `EN${new Date().getFullYear()}${studentDatabase.length + 1002}`,
                            phone: '987654321' + (studentDatabase.length + 2),
                            email: `student${studentDatabase.length + 2}@example.com`,
                            course: document.querySelector(`#importCourse option[value="${course}"]`).textContent,
                            department: document.querySelector(`#importDept option[value="${dept}"]`).textContent,
                            batch: batch,
                            semester: '1',
                            photo: `https://randomuser.me/api/portraits/${Math.random() > 0.5 ? 'men' : 'women'}/${studentDatabase.length + 2}.jpg`,
                            address: 'Imported student address'
                        }
                    ];
                    
                    // Add to database
                    studentDatabase = [...studentDatabase, ...newStudents];
                    localStorage.setItem('studentDatabase', JSON.stringify(studentDatabase));
                    
                    // Close modal and show success
                    importModal.style.display = 'none';
                    alert(`Successfully imported ${newStudents.length} students`);
                    
                    // Reset form
                    document.getElementById('studentFile').value = '';
                    document.getElementById('importCourse').value = '';
                    document.getElementById('importDept').value = '';
                    document.getElementById('importBatch').value = '';
                    document.getElementById('importError').style.display = 'none';
                    
                    // Update displays
                    displayStudentList();
                    updateDashboard();
                } catch (error) {
                    showImportError('Error parsing file: ' + error.message);
                }
            };
            
            reader.onerror = function() {
                showImportError('Error reading file');
            };
            
            reader.readAsArrayBuffer(file);
        }

        function addNewCourse() {
            const code = document.getElementById('courseCode').value;
            const name = document.getElementById('courseName').value;
            const department = document.getElementById('courseDepartment').value;
            const duration = document.getElementById('courseDuration').value;
            const semesters = document.getElementById('courseSemesters').value;
            const description = document.getElementById('courseDescription').value;
            
            // Validate inputs
            if (!code || !name || !department || !duration || !semesters) {
                alert('Please fill all required fields');
                return;
            }
            
            // Check if course code already exists
            if (courses.some(course => course.code.toLowerCase() === code.toLowerCase())) {
                alert('A course with this code already exists');
                return;
            }
            
            // Create new course
            const newCourse = {
                id: courses.length > 0 ? Math.max(...courses.map(c => c.id)) + 1 : 1,
                code,
                name,
                department: document.querySelector(`#courseDepartment option[value="${department}"]`).textContent,
                duration: parseInt(duration),
                semesters: parseInt(semesters),
                description
            };
            
            // Add to database
            courses.push(newCourse);
            localStorage.setItem('courses', JSON.stringify(courses));
            
            // Close modal and show success
            addCourseModal.style.display = 'none';
            alert('Course added successfully');
            
            // Reset form
            document.getElementById('courseForm').reset();
            
            // Update displays
            displayCourses();
            updateDashboard();
        }

        function addNewDepartment() {
            const code = document.getElementById('departmentCode').value;
            const name = document.getElementById('departmentName').value;
            const head = document.getElementById('departmentHead').value;
            const description = document.getElementById('departmentDescription').value;
            
            // Validate inputs
            if (!code || !name || !head) {
                alert('Please fill all required fields');
                return;
            }
            
            // Check if department code already exists
            if (departments.some(dept => dept.code.toLowerCase() === code.toLowerCase())) {
                alert('A department with this code already exists');
                return;
            }
            
            // Create new department
            const newDepartment = {
                id: departments.length > 0 ? Math.max(...departments.map(d => d.id)) + 1 : 1,
                code,
                name,
                head,
                description
            };
            
            // Add to database
            departments.push(newDepartment);
            localStorage.setItem('departments', JSON.stringify(departments));
            
            // Close modal and show success
            addDepartmentModal.style.display = 'none';
            alert('Department added successfully');
            
            // Reset form
            document.getElementById('departmentForm').reset();
            
            // Update displays
            displayDepartments();
            updateDashboard();
        }

        function showImportError(message) {
            const errorElement = document.getElementById('importError');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function updateDashboard() {
            displayDashboardStats();
            displayRecentAttendance();
            initAttendanceChart();
        }

        function initAttendanceChart() {
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (attendanceChart) {
                attendanceChart.destroy();
            }
            
            // Group attendance by date
            const attendanceByDate = {};
            attendanceRecords.forEach(record => {
                const date = record.date;
                if (!attendanceByDate[date]) {
                    attendanceByDate[date] = { present: 0, absent: 0, late: 0, halfday: 0 };
                }
                attendanceByDate[date][record.status]++;
            });
            
            // Prepare chart data
            const dates = Object.keys(attendanceByDate).sort();
            const presentData = dates.map(date => attendanceByDate[date].present || 0);
            const absentData = dates.map(date => attendanceByDate[date].absent || 0);
            const lateData = dates.map(date => attendanceByDate[date].late || 0);
            const halfdayData = dates.map(date => attendanceByDate[date].halfday || 0);
            
            // Get colors based on current theme
            const isDarkMode = document.body.classList.contains('dark-mode');
            const bgColor = isDarkMode ? '#2d2d2d' : 'white';
            const textColor = isDarkMode ? '#f0f0f0' : '#333';
            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            attendanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Present',
                            data: presentData,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Absent',
                            data: absentData,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(231, 76, 60, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Late',
                            data: lateData,
                            backgroundColor: 'rgba(243, 156, 18, 0.7)',
                            borderColor: 'rgba(243, 156, 18, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Half Day',
                            data: halfdayData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: textColor
                            }
                        },
                        title: {
                            display: true,
                            text: 'Attendance Overview',
                            color: textColor,
                            font: {
                                size: 16
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                }
            });
        }

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const courseFilter = document.getElementById('filterCourse').value;
            
            let filteredStudents = studentDatabase;
            
            // Apply search filter
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student => 
                    student.firstName.toLowerCase().includes(searchTerm) ||
                    student.lastName.toLowerCase().includes(searchTerm) ||
                    student.enrollment.toLowerCase().includes(searchTerm) ||
                    student.course.toLowerCase().includes(searchTerm) ||
                    student.department.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply course filter
            if (courseFilter) {
                filteredStudents = filteredStudents.filter(student => 
                    student.course.toLowerCase() === courseFilter
                );
            }
            
            // Update current page and display
            currentPage = 1;
            displayFilteredStudents(filteredStudents);
        }

        function filterStudentsByDepartment(dept) {
            document.getElementById('studentSearch').value = '';
            document.getElementById('filterCourse').value = '';
            
            const deptName = document.querySelector(`[data-dept="${dept}"]`).textContent.trim();
            const filteredStudents = studentDatabase.filter(student => 
                student.department.toLowerCase() === deptName.toLowerCase()
            );
            
            currentPage = 1;
            displayFilteredStudents(filteredStudents);
        }

        function displayFilteredStudents(filteredStudents) {
            const studentTableBody = document.getElementById('studentTableBody');
            studentTableBody.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                studentTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No students found matching your criteria</td>
                    </tr>
                `;
                updatePaginationControls(0);
                return;
            }
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = Math.min(startIndex + studentsPerPage, filteredStudents.length);
            const paginatedStudents = filteredStudents.slice(startIndex, endIndex);
            
            // Add rows for each student
            paginatedStudents.forEach((student, index) => {
                const row = document.createElement('tr');
                const fullName = `${student.firstName} ${student.lastName}`;
                
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>
                        <img src="${student.photo}" alt="${fullName}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                    </td>
                    <td>${fullName}</td>
                    <td>${student.enrollment}</td>
                    <td>${student.course}</td>
                    <td>${student.department}</td>
                    <td>${student.batch}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn btn-primary" title="View" data-id="${student.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-warning" title="Edit" data-id="${student.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn btn-danger" title="Delete" data-id="${student.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                studentTableBody.appendChild(row);
                
                // Add event listeners to action buttons
                row.querySelector('.action-btn.btn-primary').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    viewStudentDetails(studentId);
                });
                
                row.querySelector('.action-btn.btn-warning').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    editStudent(studentId);
                });
                
                row.querySelector('.action-btn.btn-danger').addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    deleteStudent(studentId);
                });
            });
            
            // Update pagination controls
            updatePaginationControls(filteredStudents.length);
        }

        function filterAttendanceHistory() {
            const searchTerm = document.getElementById('historySearch').value.toLowerCase();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const courseFilter = document.getElementById('historyFilterCourse').value;
            const statusFilter = document.getElementById('historyFilterStatus').value;
            
            let filteredRecords = attendanceRecords;
            
            // Apply search filter
            if (searchTerm) {
                filteredRecords = filteredRecords.filter(record => 
                    record.name.toLowerCase().includes(searchTerm) ||
                    record.enrollment.toLowerCase().includes(searchTerm) ||
                    record.course.toLowerCase().includes(searchTerm) ||
                    record.department.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply date range filter
            if (startDate) {
                const start = new Date(startDate);
                filteredRecords = filteredRecords.filter(record => {
                    const recordDate = new Date(record.timestamp);
                    return recordDate >= start;
                });
            }
            
            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999); // Include entire end day
                filteredRecords = filteredRecords.filter(record => {
                    const recordDate = new Date(record.timestamp);
                    return recordDate <= end;
                });
            }
            
            // Apply course filter
            if (courseFilter) {
                filteredRecords = filteredRecords.filter(record => 
                    record.course.toLowerCase() === courseFilter
                );
            }
            
            // Apply status filter
            if (statusFilter) {
                filteredRecords = filteredRecords.filter(record => 
                    record.status === statusFilter
                );
            }
            
            // Update current page and display
            currentHistoryPage = 1;
            displayFilteredAttendanceHistory(filteredRecords);
        }

        function displayFilteredAttendanceHistory(filteredRecords) {
            const attendanceHistoryTable = document.getElementById('attendanceHistoryTable');
            attendanceHistoryTable.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                attendanceHistoryTable.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">No attendance records found matching your criteria</td>
                    </tr>
                `;
                updateHistoryPaginationControls(0);
                return;
            }
            
            // Calculate pagination
            const startIndex = (currentHistoryPage - 1) * historyPerPage;
            const endIndex = Math.min(startIndex + historyPerPage, filteredRecords.length);
            const paginatedRecords = filteredRecords.slice(startIndex, endIndex).reverse();
            
            // Add rows for each attendance record
            paginatedRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                
                // Find student for photo
                const student = studentDatabase.find(s => s.id === record.studentId);
                const photoUrl = student ? student.photo : 'https://via.placeholder.com/40';
                
                // Status badge
                let statusBadge;
                if (record.status === 'present') {
                    statusBadge = '<span class="badge badge-success">Present</span>';
                } else if (record.status === 'absent') {
                    statusBadge = '<span class="badge badge-danger">Absent</span>';
                } else if (record.status === 'late') {
                    statusBadge = '<span class="badge badge-warning">Late</span>';
                } else {
                    statusBadge = `<span class="badge badge-primary">${record.status}</span>`;
                }
                
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${record.date}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="${photoUrl}" alt="${record.name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                            ${record.name}
                        </div>
                    </td>
                    <td>${record.enrollment}</td>
                    <td>${record.course}</td>
                    <td>${record.department}</td>
                    <td>${statusBadge}</td>
                    <td>${record.time}</td>
                `;
                
                attendanceHistoryTable.appendChild(row);
            });
            
            // Update history pagination controls
            updateHistoryPaginationControls(filteredRecords.length);
        }

        function updatePaginationControls(totalStudents = studentDatabase.length) {
            const totalPages = Math.ceil(totalStudents / studentsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            
            document.getElementById('prevPageBtn').disabled = currentPage <= 1;
            document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;
        }

        function updateHistoryPaginationControls(totalRecords = attendanceRecords.length) {
            const totalPages = Math.ceil(totalRecords / historyPerPage);
            document.getElementById('historyPageInfo').textContent = `Page ${currentHistoryPage} of ${totalPages}`;
            
            document.getElementById('historyPrevPageBtn').disabled = currentHistoryPage <= 1;
            document.getElementById('historyNextPageBtn').disabled = currentHistoryPage >= totalPages;
        }

        function prevStudentPage() {
            if (currentPage > 1) {
                currentPage--;
                displayStudentList();
            }
        }

        function nextStudentPage() {
            const totalPages = Math.ceil(studentDatabase.length / studentsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayStudentList();
            }
        }

        function prevHistoryPage() {
            if (currentHistoryPage > 1) {
                currentHistoryPage--;
                displayAttendanceHistory();
            }
        }

        function nextHistoryPage() {
            const totalPages = Math.ceil(attendanceRecords.length / historyPerPage);
            if (currentHistoryPage < totalPages) {
                currentHistoryPage++;
                displayAttendanceHistory();
            }
        }
    </script>
</body>
</html>